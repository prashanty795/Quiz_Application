{% extends 'staff/staffbase.html' %}
{% block content %}
{%load static%}

<head>
  <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
  <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
  <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>


</head>

<!-- Display the timer -->
<div id="timer" class="text-center"></div>

<div class="jumbotron my-4">

  <form class="form" autocomplete="off" onsubmit="return saveAns()" action="/staff/calculate-marks" method="POST">
    {% csrf_token %}
    <h1 style="text-align: center;">{{course.course_name}}</h1>
    {% for q in questions%}
    <h3 class="text-info">{{ forloop.counter }}. {{q.question}}</h3>
    <h4 style="text-align: right;">[Marks {{q.marks}}]</h4>

    <input type="hidden" name="csrfmiddlewaretoken"
      value="C24rUotmdHawVQJL3KrqiWxvti8UffOFYUc8TRbZtLt36AVLdP3jbkzUVe3beRAa">


    <div class="form-check mx-4">
      <input class="form-check-input" type="radio" name="{{ forloop.counter }}" id="{{q.option1}}" value="Option1">
      <label class="form-check-label" for="option1">
        {{q.option1}}
      </label>
    </div>


    <div class="form-check mx-4">
      <input class="form-check-input" type="radio" name="{{ forloop.counter }}" id="{{q.option2}}" value="Option2">
      <label class="form-check-label" for="option2">
        {{q.option2}}
      </label>
    </div>


    <div class="form-check mx-4">
      <input class="form-check-input" type="radio" name="{{ forloop.counter }}" id="{{q.option3}}" value="Option3">
      <label class="form-check-label" for="option3">
        {{q.option3}}
      </label>
    </div>


    <div class="form-check mx-4">
      <input class="form-check-input" type="radio" name="{{ forloop.counter }}" id="{{q.option4}}" value="Option4">
      <label class="form-check-label" for="option4">
        {{q.option4}}
      </label>
    </div>

    {% endfor %}
    <input class="btn btn-info btn-lg" type="submit" value="Submit">
  </form>
</div>

<script>
  var remainingTime = {{ remaining_time }} * 60;

  document.addEventListener('keydown', function(event) {
    if ((event.key === 'F5' || (event.ctrlKey && event.key === 'r')) && remainingTime > 0) {
      event.preventDefault();
    }
  });

  function clearPreviousAnswers() {
    var ele = document.getElementsByTagName('input');
    for (i = 0; i < ele.length; i++) {
      if (ele[i].type == "radio") {
        ele[i].checked = false;
        document.cookie = ele[i].name + "=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
      }
    }
  }

  window.onload = clearPreviousAnswers;

  function updateTimer() {
    var hours = Math.floor(remainingTime / 3600);
    var minutes = Math.floor((remainingTime % 3600) / 60);
    var seconds = remainingTime % 60;

    var timerDisplay = document.getElementById('timer');
    timerDisplay.textContent = 'Time Remaining: ' + pad(hours) + ':' + pad(minutes) + ':' + pad(seconds);
    remainingTime--;
    if (remainingTime < 0) {
      saveAns();
      document.querySelector('form').submit();
    }
  }

  setInterval(updateTimer, 1000);

  function pad(num) {
    return (num < 10 ? '0' : '') + num;
  }

  function saveAns() {
    var ele = document.getElementsByTagName('input');
    for (i = 0; i < ele.length; i++) {
      if (ele[i].type == "radio") {
        if (ele[i].checked) {
          setCookie(ele[i].name, ele[i].value, 3);
        }
      }
    }
  }

  function setCookie(cname, cvalue, exdays) {
    var d = new Date();
    d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
    var expires = "expires=" + d.toUTCString();
    document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
  }

  window.addEventListener('beforeunload', function (e) {
  var confirmationMessage = 'Are you sure you want to leave? Your progress will be lost.';
  (e || window.event).returnValue = confirmationMessage;
  return confirmationMessage;
});




</script>



<br><br><br><br><br><br>
{% endblock content %}